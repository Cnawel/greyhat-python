'''
Python script that reads a PCAP file and
searches for specific keywords or patterns in HTTP payload data
'''
# pip install pyshark

import pyshark

def search_payload_for_keywords(pcap_file, keywords):
    # Create a PyShark capture object
    capture = pyshark.FileCapture(pcap_file)

    # Initialize a counter for detected instances
    detections = 0

    # Loop through each packet in the capture file
    for packet in capture:
        # Check if the packet contains an HTTP layer
        if "HTTP" in packet:
            # Get the HTTP payload (HTTP layer is present)
            payload = str(packet["HTTP"])

            # Search for keywords in the payload
            for keyword in keywords:
                if keyword in payload:
                    detections += 1
                    print(f"Detected '{keyword}' in packet #{packet.number}")

    # Analyze the results
    if detections > 0:
        print(f"Detected {detections} potential keywords in the HTTP payload.")
    else:
        print("No potential keywords detected.")

if __name__ == "__main__":
    # Replace 'your_capture.pcap' with the path to your PCAP file
    pcap_file_path = 'your_capture.pcap'

    # Define a list of keywords or patterns to search for
    detection_keywords = ["malware", "exploit", "vulnerability", "payload_pattern"]

    search_payload_for_keywords(pcap_file_path, detection_keywords)
